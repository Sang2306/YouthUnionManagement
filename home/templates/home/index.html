{% extends 'base.html' %}
{% load static %}
{% block title %} Home page {% endblock title %}
<!--active tab-->
{% block home_active %} active {% endblock %}
{% block add_lib %}
    <script type="text/javascript" src="{% static 'youth_union/all.min.js' %}"></script>
    <script src="{% static 'youth_union/pdfobject.min.js' %}"></script>
{% endblock %}
<!-- Xin chao Ten nguoi dung -->
{% block hello_user %}
    {% if user.name is not None %}
        (Xin chào {{ user.name }})
    {% endif %}
{% endblock hello_user %}
{% block add_stylesheet %}
    <style>
        .comment-sp {
            padding: 10px;
            border-radius: 4px;
            background-color: #1ec04a;
            cursor: pointer;
            font-size: 110%;
        }
    </style>
{% endblock %}
<!-- Block admin -->
{% block admin %}
    {% if user.role.role_ID == 2 %}
        <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
               aria-expanded="false">Quản trị <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li>
                    <a href="#" data-toggle="modal" data-target=".bd-example-modal-sm">
                        <span class="glyphicon glyphicon-export"></span>
                        Export XLS
                    </a>
                </li>
                <li role="separator" class="divider"></li>
                <li>
                    <a href="{% url 'youth_union:check-attendance' %}"><span class="glyphicon glyphicon-check"></span>
                        Điểm
                        danh</a>
                </li>
            </ul>
        </li>
    {% elif user.role.role_ID == 3 %}
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
               aria-expanded="false">Quản trị <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li>
                    <a href="{% url 'youth_union:upload' %}"><span class="glyphicon glyphicon-cloud-upload"></span>
                        Upload
                        thông
                        báo</a></li>
                <li><a href="{% url 'youth_union_admin:user-view' %}">Quản trị</a></li>
            </ul>
        </li>
    {% endif %}
{% endblock %}
<!--Thong bao trang chu-->
{% block content %}
    {% csrf_token %}
    <div class="row" style="margin-left: 10px; margin-right: 10px;">
        <div class="col-12">
            <strong style="font-style: italic; color: #006699;">*THÔNG BÁO</strong>
            <!-- Hien thi thong bao -->
            <h4 class="font-weight-light text-center text-uppercase bg-success text-white" style="padding: 40px">Thông
                báo bằng file pdf</h4>
            <div id="announce_pdf"></div>
            {% if announce %}
                {% for ann in announce %}
                    <script>PDFObject.embed("{{ ann.pdf_file.url }}", "#announce_pdf");</script>
                    </br>
                    <a href="{{ ann.pdf_file.url }}"> {{ ann.pdf_file.url }} </a>
                    </br>
                {% endfor %}
                <ul class="pagination justify-content-center">
                    <li class="page-item"><a class="page-link" href="?page=1">First</a></li>
                    {% if announce.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ announce.previous_page_number }}" tabindex="-1">
                                <i class="glyphicon glyphicon-chevron-left"></i>
                            </a>
                        </li>
                    {% endif %}
                    <li class="page-item active">
                        <a class="page-link" href="?page=2">{{ announce.number }}
                            / {{ announce.paginator.num_pages }}</a>
                    </li>
                    {% if announce.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ announce.next_page_number }}">
                                <i class="glyphicon glyphicon-chevron-right"></i>
                            </a>
                        </li>
                    {% endif %}
                    <li class="page-item"><a class="page-link" href="?page={{ announce.paginator.num_pages }}">Last</a>
                    </li>
                </ul>
            {% else %}
                <h4 style="text-align: center;">KHÔNG CÓ THÔNG BÁO NÀO</h4>
            {% endif %}
        </div>
        <hr>
        <div class="col-12" style="margin-bottom: 10px;">
            <h4 class="font-weight-light text-center text-uppercase bg-success text-white" style="padding: 40px">Thông
                báo
                bằng
                bài viết</h4>
            <hr>
            {% for message in messages %}
                <div class="row shadow-sm" style="background-color: white; padding: 40px;
                    margin-left: 10px; margin-right: 10px; border-radius: 5px; border: 1px solid rgba(0,0,0,.125);">
                    <div class="col-12" style="margin-left: 10px; margin-right: 10px;">
                        <p style="font-size: 14px; color: blue; display: inline-block">{{ message.title }}</p>
                        <button onclick="up({{ message.id }})"><i class="far fa-arrow-alt-circle-up" style="cursor: pointer" title="Thu gọn"></i>
                        </button>
                        <button onclick="down({{ message.id }})">
                            <i class="far fa-arrow-alt-circle-down down"
                               style="cursor: pointer"
                               title="Mở rộng"></i>
                        </button>

                        <br>
                        <small><i class="far fa-clock"></i> {{ message.date_created }}</small>
                    </div>
                    <div class="col-12" style="margin-left: 10px; margin-right: 10px;
                         border-radius: 5px;
                         padding: 15px; margin-top: 10px;
                         border: 1px solid rgba(30,192,74,0.88);">
                        <span style="padding: 5px;">{{ message.content|safe }}</span>
                    </div>
                    <div class="col-12 commented-sec-{{ message.id }}">
                        {% for comment in message.comment_set.all %}
                            <div class="row" style="margin-left: 10px; margin-right: 10px; padding: 8px">
                                <div class="col-12">
                                    <span style="font-weight: bolder">{{ comment.user }}</span>
                                    <small>{{ comment.date_created|date:'d-m-Y H:i' }}</small>
                                    <blockquote>{{ comment.content }}</blockquote>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="col-12" style="margin-top: 15px; margin-left: 10px;">
                        <span class="comment-sp" style="color: #fff;"><i class="fas fa-reply" style="color: #fff;"></i> Phản hồi</span>
                        <div class="input-rep-sec" hidden>
                            <textarea class="form-control content-{{ message.id }}" style="margin-top: 10px;"
                                      placeholder="Nhập phản hồi..."></textarea>
                            <button class="btn btn-success sent-comment" data-message-id="{{ message.id }}"
                                    style="border-radius: 0px; float: right">
                                Gửi <i class="fas fa-paper-plane" style="color: white"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <br>
            {% endfor %}
        </div>
    </div>
    {#  pls wait modal  #}
    <div class="modal" id="pls-wait" tabindex="-1" role="dialog"
         aria-labelledby="rs_keywords_form_title" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content border-0 rounded-5 shadow-lg">
                <div class="modal-body">
                    Vui lòng đợi...
                </div>
            </div>
        </div>
    </div>


{% endblock content %}
{% block short_script %}
    <script>
        $(".comment-sp").on("click", function () {
            $(this).find("~ .input-rep-sec").removeAttr("hidden");
        });

        $(".sent-comment").on("click", function () {
            let message_id = this.getAttribute("data-message-id");
            let content = $(`.content-${message_id}`).val();
            let html;
            $("#pls-wait").modal({backdrop: 'static', keyboard: false});
            $("#pls-wait").modal("show");
            $.post(
                "{% url 'youth_union_admin:add-comment' %}",
                {
                    "message_id": message_id,
                    "content": content,
                    "csrfmiddlewaretoken": document.querySelector("input[name=csrfmiddlewaretoken]").value,
                },
                function (data) {
                    window.location.reload()
                }
            )
        });
        function up(id) {
            $(`.commented-sec-${id}`).attr("hidden", "");
        }
        function down(id) {
            $(`.commented-sec-${id}`).removeAttr("hidden");
        }
    </script>
{% endblock %}
